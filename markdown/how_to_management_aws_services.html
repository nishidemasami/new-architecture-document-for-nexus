
<!DOCTYPE HTML>
<html lang="ja" >
    <head>
        <meta charset="UTF-8">
        <title>利用者が増えても自動でスケールするシステムの開発手法 · HonKit</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="HonKit 5.1.0">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/@honkit/honkit-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="how_to_develop.html" />
    
    
    <link rel="prev" href="../" />
    

    </head>
    <body>
        
<div class="book honkit-cloak">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="検索ワードを入力" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    よりよいシステム開発の手引き
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.2" data-path="how_to_management_aws_services.html">
            
                <a href="how_to_management_aws_services.html">
            
                    
                    利用者が増えても自動でスケールするシステムの開発手法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="how_to_develop.html">
            
                <a href="how_to_develop.html">
            
                    
                    AIによるプログラム生成（またはフリーランス・オフショア・未熟なプログラマーなど）により開発されたプログラムの品質を担保する手法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="how_to_management_documents.html">
            
                <a href="how_to_management_documents.html">
            
                    
                    生産性が高く修正の追跡が可能な仕様書管理手法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="how_to_define_requirements.html">
            
                <a href="how_to_define_requirements.html">
            
                    
                    現代的な要件定義の手法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" >
            
                <span>
            
                    
                    保守性が高くセキュリティが高いシステム開発の手法
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="practice.html">
            
                <a href="practice.html">
            
                    
                    実践
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" >
            
                <span>
            
                    
                    付録：使用ソフトウェア・ライブラリ・サービス一覧
            
                </span>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="appendix/mermaid_samples.html">
            
                <a href="appendix/mermaid_samples.html">
            
                    
                    付録：Mermaid記法 サンプル集
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="appendix/plantuml_samples.html">
            
                <a href="appendix/plantuml_samples.html">
            
                    
                    付録：PlantUML記法 サンプル集
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="appendix/markdown_samples.html">
            
                <a href="appendix/markdown_samples.html">
            
                    
                    付録：Markdown記法 サンプル集
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://github.com/honkit/honkit" target="blank" class="gitbook-link">
            HonKitで公開 
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >利用者が増えても自動でスケールするシステムの開発手法</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="利用者が増えても自動でスケールするシステムの開発手法">利用者が増えても自動でスケールするシステムの開発手法</h1>
<p>AWSを十分に活用すれば、自動でAWSの以下の恩恵に預かることができます。</p>
<ul>
<li>アクセス数が多くても自動でスケールアウトしてすることができる。</li>
<li>アクセス数が少ない場合、自動でスケールインするようにできる。利用がない時は課金額をゼロに近くできる。</li>
<li>アップデートが自動で安全に適用される。</li>
<li>セキュリティが高いシステムが低コストで構築できる。</li>
<li>ユーザーにストレスの無い、快適に動作するシステムが低コストで開発できる。</li>
<li>システムダウンの少ない可用性の高いシステムを低コストで運用できる。</li>
</ul>
<p>そのためには原則、以下の通りにします。</p>
<ul>
<li>EC2でWEBアプリケーションを稼働させるべきではない。WEBアプリケーションはLambdaで稼働させる。</li>
<li>DBはDynamoDBで稼働させる。</li>
<li>ファイルはS3に保存する。</li>
<li>フロントエンドはNext.jsで開発しCloudFrontとS3で公開する。</li>
<li>認証にはCognitoを使用する。</li>
<li>データの送受信はAppSyncで構築する。</li>
</ul>
<h2 id="アーキテクチャの例">アーキテクチャの例</h2>
<p>アーキテクチャの例は以下の通りです。</p>
<p><?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentstyletype="text/css" height="680px" preserveAspectRatio="none" style="width:747px;height:680px;background:#FFFFFF;" version="1.1" viewBox="0 0 747 680" width="747px" zoomAndPan="magnify"><defs/><g><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="121" x="5" y="17.8281">An error has occured!</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="380" x="5" y="34.1722">The man who moves a mountain begins by carrying away small stones</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="3" x="5" y="50.5163"> </text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="241" x="5" y="66.8604">Diagram size: 683 lines / 62216 characters.</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="3" x="5" y="83.2045"> </text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="247" x="5" y="99.5487">For some reason, dot/GraphViz has crashed.</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="3" x="5" y="115.8928"> </text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="344" x="5" y="132.2369">RootCause net.sourceforge.plantuml.svek.EmptySvgException</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="281" x="5" y="148.581">net.sourceforge.plantuml.svek.EmptySvgException</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="538" x="11" y="164.9251">net.sourceforge.plantuml.svek.GeneralImageBuilder.buildImage(GeneralImageBuilder.java:450)</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="648" x="11" y="181.2692">net.sourceforge.plantuml.svek.CucaDiagramFileMakerSvek.createFileInternal(CucaDiagramFileMakerSvek.java:103)</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="597" x="11" y="197.6133">net.sourceforge.plantuml.svek.CucaDiagramFileMakerSvek.createFile(CucaDiagramFileMakerSvek.java:69)</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="530" x="11" y="213.9575">net.sourceforge.plantuml.baraye.CucaDiagram.exportDiagramInternal(CucaDiagram.java:646)</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="459" x="11" y="230.3016">net.sourceforge.plantuml.UmlDiagram.exportDiagramNow(UmlDiagram.java:135)</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="480" x="11" y="246.6457">net.sourceforge.plantuml.AbstractPSystem.exportDiagram(AbstractPSystem.java:179)</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="501" x="11" y="262.9898">net.sourceforge.plantuml.SourceStringReader.outputImage(SourceStringReader.java:163)</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="353" x="11" y="279.3339">net.sourceforge.plantuml.Pipe.generateDiagram(Pipe.java:101)</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="316" x="11" y="295.678">net.sourceforge.plantuml.Pipe.managePipe(Pipe.java:92)</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="317" x="11" y="312.0221">net.sourceforge.plantuml.Run.managePipe(Run.java:354)</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="275" x="11" y="328.3663">net.sourceforge.plantuml.Run.main(Run.java:181)</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="3" x="5" y="344.7104"> </text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="290" x="5" y="361.0545">This has been generated with PlantUML (1.2022.14).</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="3" x="5" y="377.3986"> </text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="327" x="5" y="393.7427">This version of PlantUML is 287 days old, so you should</text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="346" x="5" y="410.0868">consider upgrading from https://plantuml.com/download</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="3" x="5" y="426.4309"> </text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="250" x="5" y="442.7751">Java Runtime: OpenJDK Runtime Environment</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="173" x="5" y="459.1192">JVM: OpenJDK 64-Bit Server VM</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="190" x="5" y="475.4633">Default Encoding: ANSI_X3.4-1968</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="75" x="5" y="491.8074">Language: en</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="66" x="5" y="508.1515">Country: US</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="3" x="5" y="524.4956"> </text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="164" x="5" y="540.8397">PLANTUML_LIMIT_SIZE: 4096</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="3" x="5" y="557.1839"> </text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="287" x="5" y="573.528">Default dot version: dot - graphviz version 2.43.0 (0)</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="3" x="5" y="589.8721"> </text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="438" x="5" y="606.2162">Please go to https://plantuml.com/graphviz-dot to check your GraphViz version.</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="3" x="5" y="622.5603"> </text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="263" x="5" y="638.9044">You should send this diagram and this image to</text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="130" x="271" y="638.9044">plantuml@gmail.com</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="12" x="404" y="638.9044">or</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="38" x="5" y="655.2485">post to</text><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="149" x="46" y="655.2485">https://plantuml.com/qa</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="101" x="198" y="655.2485">to solve this issue.</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="354" x="5" y="671.5927">You can try to turn around this issue by simplifing your diagram.</text><image height="40" width="54" x="688" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADYAAAAoCAYAAAC1mQk2AAAEfUlEQVR4XtWXvYoUURCFJ99QjWUDAwN9ABNhA2ENBYMV44FVwR9YIxFhEXTfYMHETN9AxMR8HkAQn8FHaPlavuVMTc/O387OdEHR3bfvvVWnTlXd7sFgCbl67Uqze+N6w1Wtc3ojd+/sNg8OHjZPjl42p6enY/r2+F0zHA7bd3v797cfKA7i6PvXj5tPJ4et/vj2vfn89cuY5hhAtxrgzVu3J9gRBMozLMkUrCVQlDEA1r03JoASSDr76/ffVnWa1AQYV5Vn1sri8YeT7QCHEzBg1NHRaDTGAsqcqgmSe0AJkLFq69JEpkw1UxHHuNdhAXhvOnYBlG322RhzyVQFks5nw/AqoJznczaWSwcHWwkqnfSKY6QlwrWqzNRgCN531fZaRQcwbholKJ3XQeqMGsquKWjGBca4Dce1nInV/lqE9LCWKlMAsIHgsA1BTaZQx7g3ndnXedw/e7Q3AcwvmTq+kgBMNqyrdIqIp+O2/VTXy7zg7LI1XUl9bAPo585Oq3wAMO67lYQoyQpsZMNg3DSSqYx8pqAABSdQ9skA1VoTVPPiVfseO/c+/ml1pa8XooMxnM1DN+vDNJUZjNv5PNcE7XxT1b1Yk0HJc01gvneO5QBAmE2/Z0p+ZWSz4CoYHU9GrDeB+cx7WZGBBOd79pANv0mZA1Oma5aFPi2UpqaZDtSit240KDDmAooxWdRBA5HssqdB4rn6gbDePdTs0u4zM00zFXEQw25m/XQxlkwlS44LOCNeu++5jg3+NxbmdYFNPzvTlMFsDNYQiwSmM1lDCcxnAWpUQBlp9+F99aUK82vA3VcGLYGJLxqiZtRNNyey0K4oOLufgE3Dmi6pOKUzMsn9eYwBwGCbupBAhgnQwCf4MfaYlMBQaTYFBaExAQrS9BKokZVV7k0hlWccrQAFhZriyQjzWWfwE+BYc+ETh79kJ1hXRiZBy5zPMmoaCryyJlBBG4SsFes6g2XAzpwtkh2V9RMv3zw9OHMsm4QOyRLjOGfUZUU2BZopqFFB6oj1ofre0tDWQi2+SnYsHMsG4DWdN6oCzlyXEfYQkCnqfrKVqeq7XO+6pcHBGpuZYhjBKUGlYQxlWloHppOO+cx7m43vpwGT5WxG2loaHB3F6Gp4Grh0nqtnjc4ZadNKUNix+HW8pmGmprYNQvV5bsEgG8ic4HC6C2Q6U1PVPQDG2tr9BOg+yXbd1/uJ82oR8cQ32haxDAlSFUzWXNbqLGfcw7rOvU1bGZy110whmmwsCxl9HbA+BJHKOhyZpy4IJGusQ1nSlqmNzc7Pp2XEWjA9ZbCCsS75WXx+uN9G1tTDmfP+kLFhVxWMAc1ar+suRPKkx4hRzfwnovVLov4h8zFQoy5jAmGfaUFYu2A4jU9zBCD5h4zj/iFnmiawtbFz0dL1h4zazskEx0jFeepya8RmlH/IeRaitv2aqr0QazXPq9reufaKtRQPZ8EJ1GePFILQSwZxuuurRpB23t4ChEFBJnPZVFb+pNq0CFCQMObnWq+BVbHh9OZ8W6f8A4IUjfPb5dBYAAAAAElFTkSuQmCC" y="6"/><!--SRC=[hLPHQnj747xNhzYwWLfW-PAweM3SW2NBnc0xnahnYy6izaQdnQlTw-wU5QNumNPf-bBIFeJGGXyCnOGK2drewKEWF-PmxFwBpksTT2VfhBYbzt2tEplpVJEpixDdZhWCgQOzOhhKLtqk0zAXma2botqWZ6ice58n8pMfBDGfEmgqYgJVK49fij_b5YPrbFP1f-jrWGP5a13dD7Wlpb1j2YfNOO8Qisgjvkt8mYPJiiMV0Ra_gKA-h11IpaV8gjQgNyH7rIdEas801hw8G39mi2NckrHRpdX8fPr66b- -nQSjte4jBk4zZaG663NmluH7yFd0XmwoajNzrcxK4wHhRMYMFK_J_cB0RJTg8wF6D5kGTf6fdaVxHj2sIRurZWkcrb6w5WgC3G6yumSF5-zxFZVMuQSaN38H-ICM3xyDrUifkHZYz5QTvjCGDEyXCnKpD3Sm1o4w96OfhOQXu8nQhkGc1XDeDqp4hO5aCmpHqH1BpTkYlRPFq_Tw95bYFiDiZLhQnftorWQIzjHQVLO0845Jj54iIg8rTz3TZeJ5rFYSta7v2Gt1MANnSDr1-tFSyJkeuNoRIeHCN6vW8IWn2tqxyRK5-fWpC5vJGBglJepMnw3jB6lAkbYdMq2rn9xbFT5K6ePTO1Rb3jY-qdXsWaPQm6iWE18Dl8PGaR-kKJh3l0KiqjmEDdqqnMzI2O9JR0DO587aLiqoJjFjjJWQGJRBmfysYxJuZrwxrqSaEyOimctkaQGhX0JF9LdjqMTAajOIQKVi2D93YKpkpBX-W3pphQMwMtNI1VBXkdiM4iN3nkEjntk76tlDviu2mMFEPNMiSupPpWU755Da5aXmY5q2n6TpanxCLKVyJPVMAPiIth8iBenJLulfI5i2eHg81cQf30GOqiU6HkWmISOE1613JQv0Oq63ieCGI8r809zOHP8RqU6vgp5NSRAy9GlCWhDKsdRLnEA8tNNiz9disqcqzOqqu5ofqB5jKko8XxNWra_oK7FykNl9kTtStfYl7iZu_38-VnkV_O7lEK9DSc_et2hflqajfNl6ac4rzsyF0knjwPfsushc_KXbahgiEMQkfC83UVNyylgxhvqpmed6m98dyP7K7cNBosJbNWDxkehiuIUF3iIkAbufPKvaXpBZpMO7ykRDjpUltrx_UZ6aprQc-5DUie8kP2hBf9Z88b2vyokrectk_nBwdrfFHp1-VinIjL0fPL6MjTqivFrcFJxxFJxxEJx_naNQXxR1VmApD8PuKXaVLKgJEUermtpgeG37QpiEtrLE9v6D4UHYbyoH5yMKV8mf-Vkd7wv__2e-VncVNJYlVwbCrmC2v7X5X0U8K8mOT_hrcwkNBswFARliiu2ocGia6u_HPx9_KG-bfCFxFsCTJXtjS78BBn8FDOg1Vug1n-VFdHz_NRru5Pz-_-xFY_ZqLNdsChmYmiCYmitbwRlVphB6yWy0]--></g></svg></p>
<h2 id="なぜec2でwebアプリケーションを稼働させるべきではないか">なぜEC2でWEBアプリケーションを稼働させるべきではないか</h2>
<p>以下の理由から、EC2でWEBアプリケーションを稼働させるべきではありません。</p>
<ul>
<li>EC2の本番環境にどんどん手が加えられ、いわゆる「秘伝のタレ」化してしまい、トラブルが発生した時に本番環境を新たに再構築できない事態が発生しうる</li>
<li>EC2のSLAは99.5%と非常に低く、よく落ちる</li>
<li>新規開発システムをEC2でWEBアプリケーションを稼働させるメリットが無い。既存システムを利用するためであっても、EC2を利用するのではなくさくらインターネットの「さくらのVPS」やNTTの「WebARENA Indigo」などのサービスを利用したほうが運用コストが低くシステムの停止も少なくサービス品質も高い。</li>
<li>EC2は自動ではスケールアップもスケールアウトもされず、急に大量のアクセスが来た場合に対応できない。また、スケールダウンもスケールインも自動ではされないため、たとえ1件もアクセスが来なくても同じ額が課金されてしまう。</li>
<li>スケールアップもスケールアウトもしないシステムの場合、アクセス数の予測が難しい場合や日時によってアクセス数に増減がある場合などはアクセス数が最も多い瞬間に合わせてインスタンスの性能を決定しなければならないため、無駄が多い。</li>
</ul>
<p>極力WEBアプリケーションはLambdaで稼働させるべきです。<br>EC2と比較した、LambdaでWEBアプリケーションを稼働させるメリットは以下の通りです。</p>
<ul>
<li>EC2ではアクセスが無い時でも課金されるが、Lambdaであれば課金はアクセスに応じてのミリ秒単位であるため、運用コストが抑えられる(極端な話、アクセスが0件であれば課金されない)</li>
<li>EC2ではセキュリティアップデートを自己責任でシステムを停止させて実施しなければならないが、Lambdaであればセキュリティアップデートが自動で安全に実施されシステム停止も発生しない（※Lambdaでもセキュリティアップデートを手動でする設定もある）</li>
<li>EC2ではアクセスに応じてスケールアップ・スケールアウトさせるのが難しいが、Lambdaでは自動でスケールするため、急な大量のアクセスにも柔軟に対応できる</li>
<li>EC2はSLAが99.5%(最大月間3.6時間も、サービスが落ちていることを許容する計算になる)しかないが、LambdaはSLAが99.95%(最大でも月間21.6分しかサービスが落ちていることを許容しない計算になる)であるため品質が高い</li>
</ul>
<h1 id="awsの各サービスの使い方">AWSの各サービスの使い方</h1>
<h2 id="aws-lambda">AWS Lambda</h2>
<p>AWSの最も先進的かつ便利なサービスのうちの1つです。</p>
<p>以下のメリットがあります。</p>
<ul>
<li>課金がミリ秒単位であるため、運用コストが抑えられる(極端な話、アクセスが0件であれば課金されない)</li>
<li>SLAが99.95%と、非常に高い稼働率が期待できる。</li>
<li>様々なプログラミング言語に対応しており、処理の目的に応じてプログラミング言語を使い分けることができる。</li>
<li>コールドスタートが非常に高速で、EC2では対応できないような場面にも対処できる。<ul>
<li>Javaの場合普通に使用するとコールドスタートは遅いが、その場合でもGraalVMを利用すればコールドスタートも高速になる。</li>
</ul>
</li>
<li>自動でスケールアウトするため、</li>
</ul>
<h2 id="amazon-cognito">Amazon Cognito</h2>
<p>ユーザーの認証を管理するサービスです。
現代のWEBサービスに必要な</p>
<ul>
<li>ユーザー登録</li>
<li>メール・電話番号認証</li>
<li>クッキー管理</li>
<li>SNS認証
などの機能を一通り備えています。</li>
</ul>
<p>一般的なWEBサービスで必要とされる機能をほぼ網羅しており、ほとんどのユースケースで必要十分な機能を備えています。</p>
<h2 id="amazon-s3">Amazon S3</h2>
<p>ファイルを保存するストレージです。
非常に様々な用途が想定されていて、たとえば以下のようなこともできます。</p>
<ul>
<li>インターネットへ公開するファイルを保存する。</li>
<li>ユーザーから保存を受け付けるがユーザーへの公開はしない、書き込み専用読み込み不可ストレージ。</li>
<li>AppSyncやLambdaから、ファイル名を主キーとしたデータソースとして利用する</li>
</ul>
<h2 id="amazon-cloudfront">Amazon CloudFront</h2>
<p>全世界に分散して配置されているCDNです。
世界中のどこからアクセスしても速く、S3に用意されたファイルをWEBで配信するのに便利です。</p>
<hr>
<p>ここから書きかけです</p>
<hr>
<h2 id="amazon-dynamodb">Amazon DynamoDB</h2>
<p>DynamoDB を使用した設計とアーキテクチャの設計に関するベストプラクティス - Amazon DynamoDB<br><a href="https://docs.aws.amazon.com/ja_jp/amazondynamodb/latest/developerguide/best-practices.html" target="_blank">https://docs.aws.amazon.com/ja_jp/amazondynamodb/latest/developerguide/best-practices.html</a></p>
<h2 id="amazon-aurora-serverless-v2">Amazon Aurora Serverless v2</h2>
<p>DynamoDBが使えない領域での第二の選択肢です。
最小構成で、一切利用が無い場合でも北米リージョンで$43.2、東京リージョンで$72のコストがかかる。(当然ながら、DynamoDBでは一切利用が無い場合は保存データ料金を除いて無料です。)</p>
<h2 id="amazon-rds">Amazon RDS</h2>
<h2 id="aws-appsync">AWS AppSync</h2>
<h2 id="amazon-sqs">Amazon SQS</h2>
<h2 id="amazon-ses">Amazon SES</h2>
<h2 id="amazon-ec2">Amazon EC2</h2>
<p>EC2は非常に高価ですが、「スポットインスタンス」というインスタンスがあり、これがどういうものかというと「空いている時間に利用できる、料金が非常に安いインスタンス」です。
夜間バッチなどのバッチ処理などに利用すると非常に安価にデータ処理がおこなえます。</p>
<h2 id="amazon-ecs・amazon-eks">Amazon ECS・Amazon EKS</h2>
<p>Dockerコンテナを立ち上げるためのサービスがAmazon ECSやAmazon EKSです。Kubernetesによる運用が必要な場合はEKSを使用しますが、多くの場合はECSで十分です。</p>
<p>KubernetesをAWS上で運用できるサービスです。EKSは料金面ではGoogle CloudのGKE(Google Kubernetes Engine)よりも割高で、Kubernetesが必要な場合にはGKEの利用をおすすめします。</p>
<p>起動に時間がかかる（数分）ので、オンライン処理には通常は利用できません。バッチ処理などで利用します。</p>
<p>Amazon ECSは以下などを使用してコンテナを立ち上げます。</p>
<ul>
<li>AWS Fargate</li>
<li>AWS EC2</li>
<li>Amazon ECS on AWS Outposts
などを使用します。</li>
</ul>
<h3 id="aws-fargate">AWS Fargate</h3>
<p>EC2よりは管理する項目が少なく、Lambdaよりは自由度が高い、EC2とLambdaの中間のような存在がFargateです。新規開発ならばLambdaのメリットが圧倒的に強いので見劣りしがちですが、高負荷処理や時間のかかる処理、同時実行数が多い処理などのLambdaでは対応できないようなユースケースではFargateが必要になります。</p>
<h3 id="aws-ec2">AWS EC2</h3>
<p>スポットインスタンスを使用するならば安価に処理することができます。</p>
<h3 id="amazon-ecs-on-aws-outposts">Amazon ECS on AWS Outposts</h3>
<p>オンプレで処理する方法です。これは自社データセンターを持っているような会社が使うものなのでここでは説明を割愛します。</p>
<h1 id="awsを使用したwebアプリケーションの開発方法">AWSを使用したWEBアプリケーションの開発方法</h1>
<p>どうやってAWSを使用したWEBアプリケーションの開発をおこなってゆけばよいかを説明します。</p>
<p>とは言っても、当然ながらAWSでどうやってWEBアプリケーションを開発してゆけばよいのかは公式ドキュメントによくまとまっているため、ここでは引用に留めます。</p>
<h2 id="使用するアーキテクチャ">使用するアーキテクチャ</h2>
<h3 id="サーバーレスアーキテクチャ">サーバーレスアーキテクチャ</h3>
<h2 id="使用する手法">使用する手法</h2>
<h3 id="cicd">CI/CD</h3>
<h2 id="使用する言語">使用する言語</h2>
<h3 id="プログラミング言語">プログラミング言語</h3>
<p>実装に使用するプログラミング言語は、主にTypeScript、Go、およびRustを使用します。
これらの選定理由は以下の通りです。</p>
<ul>
<li>静的型付けにより、プログラムの正しさの検証が容易になる。</li>
<li>メジャーな言語であるため困ったときにネット上にも書籍上にも資料がたくさん見つけられる。</li>
</ul>
<h4 id="typescript">TypeScript</h4>
<h4 id="go">Go</h4>
<h4 id="rust">Rust</h4>
<h3 id="idlインタフェース記述言語">IDL(インタフェース記述言語)</h3>
<p>インタフェースの記述に使用するIDLは、主にProtocol Buffers、GraphQLを使用します。</p>
<h4 id="protocol-buffers">Protocol Buffers</h4>
<h4 id="graphql">GraphQL</h4>
<h2 id="使用する技術">使用する技術</h2>
<h3 id="knative">Knative</h3>
<h3 id="docker">Docker</h3>
<p>AWS Fargate</p>
<h2 id="serverless-framework">Serverless Framework</h2>
<h2 id="reactjs・nextjs">React.js・Next.js</h2>
<h1 id="sla">SLA</h1>
<h2 id="各サービスのsla一覧">各サービスのSLA一覧</h2>
<table>
<thead>
<tr>
<th>サービス名</th>
<th>SLA</th>
</tr>
</thead>
<tbody>
<tr>
<td>Amazon EC2</td>
<td>99.5%</td>
</tr>
<tr>
<td>Amazon Elastic Kubernetes Service (Amazon EKS)</td>
<td>99.95%</td>
</tr>
<tr>
<td>Amazon S3</td>
<td>99.9%</td>
</tr>
<tr>
<td>Amazon CloudFront</td>
<td>99.9%</td>
</tr>
<tr>
<td>Amazon Cognito</td>
<td>99.9%</td>
</tr>
<tr>
<td>AWS Lambda</td>
<td>99.95%</td>
</tr>
<tr>
<td>AWS AppSync</td>
<td>99.95%</td>
</tr>
<tr>
<td>Amazon DynamoDB</td>
<td>99.999% ※1リージョンの場合は99.99%</td>
</tr>
<tr>
<td>Amazon Route 53</td>
<td>100%</td>
</tr>
</tbody>
</table>
<h2 id="月間ダウンタイム早見表1ヵ月を2592000秒として計算">月間ダウンタイム早見表(1ヵ月を2592000秒として計算)</h2>
<table>
<thead>
<tr>
<th>SLA</th>
<th>ダウンタイム(秒)</th>
<th>ダウンタイム(分)</th>
</tr>
</thead>
<tbody>
<tr>
<td>99.5%</td>
<td>12960</td>
<td>216</td>
</tr>
<tr>
<td>99.9%</td>
<td>2592</td>
<td>43.2</td>
</tr>
<tr>
<td>99.95%</td>
<td>1296</td>
<td>21.6</td>
</tr>
<tr>
<td>99.99%</td>
<td>259.2</td>
<td>4.32</td>
</tr>
</tbody>
</table>
<h1 id="用語集">用語集</h1>
<h2 id="リージョン">リージョン</h2>
<p>AWSのデータセンター単位。
世界中にある。日本にも東京と大阪の2つある。</p>
<p>各種料金が北部バージニアリージョンは一番安い。
リージョン間をまたぐ通信にはまた別に料金が発生する。</p>
<h2 id="vpc">VPC</h2>
<p>Virtual Private Cloudの略。ローカルネットワークみたいなもの。
特にRDSは通常のケースではインターネットに公開しないのでVPC内で完結する設計にする。
※要注意ポイント：VPCはAZをまたぐことができる。VPC内の通信だからと油断して料金が発生する通信が大量に発生するような設計をしてしまわないように注意。
なお、VPCをまたぐ通信はVGWを作成しないといけないが、今回はVPC間通信は使わないためVGWの説明は省略する。</p>
<h2 id="サブネット">サブネット</h2>
<p>VPCの中にある小さなネットワークのこと。
サブネットはAZをまたげない。</p>
<h2 id="サブネットグループ">サブネットグループ</h2>
<p>サブネットのグループのこと。
サブネットグループは複数のAZにまたがっていることが必須となっている。</p>
<h2 id="セキュリティグループ">セキュリティグループ</h2>
<p>ファイアウォールルールのセット。
ちなみにKUSANAGIのデフォルトのセキュリティグループはポート22・80・443を通す設定になっている。</p>
<h2 id="ami">AMI</h2>
<p>アマゾンマシンイメージの略。
EC2のOSのテンプレート。全自動でEC2のインスタンスが利用可能な状態までできあがるので便利。
その用途に応じたセキュリティグループも用意してくれる。</p>
<h2 id="ec2">EC2</h2>
<p>仮想マシンみたいなもの。
基本的にAMIから作ります。
もしAMIから作らない場合、いわゆる「秘伝のタレ」化してしまい二度と同じものを作ることができなくなり、障害が起きた時にサービスを継続できない状況にすらなりうるので、必ずAMIから作り、サーバー構築も自動化かつコード化(Infrastructure as Code)します。</p>
<h2 id="infrastructure-as-code">Infrastructure as Code</h2>
<p>サーバー構築をコード化することです。
以下のメリットがあります。</p>
<ul>
<li>開発環境が開発者間で差異がなくなり、「この人の開発環境でだけ動かない」みたいなことがなくなる</li>
<li>開発環境とテスト環境、また、テスト環境と本番環境の差異が文字ベースでわかるようになり、障害対応がスムーズになる</li>
</ul>
<h2 id="route53">Route53</h2>
<p>AWSのDNSサーバ。ドメイン取得もRoute53でできる。
普通に使うとただのDNSサーバだが、AWSのいくつかのサービス(CloudFront、Elastic
Beanstalk（いくつか制約があるが）、ELB、S3)に対してAレコードをCNAMEレコードみたいな便利な使い方をすることができます。また、Route53はDNSフェイルオーバーによりリージョン障害だけでなくAWS全体の障害にも対応できるが、長くなるので説明は省略します。
今回はRoute53でAレコードをCloudFrontに紐付ける。これを使いたいためにRoute53以外の選択肢が無くなっている。</p>
<h2 id="elb">ELB</h2>
<p>EC2のロードバランサー。Elastic Load Balancingの略。
ALBとNLBとCLBがある。
昔は一つしかなかったが、あとからALBとNLBができたので従来のELBがCLB(クラシックロードバランサー)となった。
ネット上にはCLBをELBと言ってる記事があるので注意が必要。
ALBがL7ロードバランサー、NLBがL4ロードバランサー、CLBがL4/L7ロードバランサー。
負荷分散のため、高可用性のためにELBで分散する時は複数AZに分散することになる。複数リージョンに分散するのはELBではできない。複数リージョン分散にはRoute53を使うが、設計が非常に煩雑。</p>
<h2 id="alb">ALB</h2>
<p>ELBの中で一番設定が柔軟にできる。
ちなみに、必ず2つ以上のサブネットを選択する必要がある。（そのサブネットたちに処理を分散するため。）</p>
<h2 id="acm">ACM</h2>
<p>HTTPSの証明書を発行してくれる。
外部で証明書を発行しても一応設定はできるものの、これで発行しないとCloudFrontとELBの設定がちょっと面倒。
Route53で取得したドメインはACMで証明書発行が簡単にできる。</p>
<h2 id="cloudfront">CloudFront</h2>
<p>キャッシュサーバみたいなもの。
CloudFrontの証明書は北部バージニアリージョンでないとダメらしいので今回は北部バージニアリージョンで作る。
WordPressなので/wp-admin/はキャッシュしないように設定する。
ちなみに、CloudFrontを通さないとAWSの通信量の請求が高くなる。</p>
<h2 id="rds">RDS</h2>
<p>EC2のデータベース特化版みたいなもの。
ちなみにRDSにはサーバレスというのがあるが全然サーバレスじゃない。</p>
<h2 id="エンドポイント">エンドポイント</h2>
<p>各リソースにアクセスするためのURL。
たとえば以下のようになる。
vpce-1234-abcdev-us-east-1.vpce-svc-123345.us-east-1.vpce.amazonaws.com
VPC エンドポイント ID、アベイラビリティーゾーン名、リージョン名などが含まれている。
Route53にはCloudFrontのエンドポイントを、CloudFrontにはELBのエンドポイントを、それぞれ入力する。
また、ブラウザからこのURLを入力すれば(直接見ることができる設定なら)直接見ることもできる。</p>
<h2 id="sla">SLA</h2>
<p>サービス品質保証(Service Level Agreement)の略。
EC2はマルチAZの場合はSLA99.99%を保証しているが、SLA99.99%というのは年間で52.56分停止する計算になる。
（ただし、RDSは99.95%、CloudFrontは99.9%、ELBはSLA99.99%がSLA。（すべてマルチAZでのSLA））
また、シングルAZの場合はSLA90%を保証しているが、これは年間で876時間停止する計算になる。
今回はテスト環境だったのでシングルAZで構築したが、本番環境はもうちょっとお金をかけてマルチAZで構築するようにする。(無料枠には当然収まらない。)
AWS障害のニュースを耳にする機会が増えているが、他人事だと考えず、自分の使っているEC2に障害が起こることを前提として要件定義する(お客さんと、AWS障害をどの程度許容するのか要相談)。</p>
<h2 id="az">AZ</h2>
<p>アベイラビリティーゾーンの略。
物理的に別の場所に位置していて、1つが災害にあって障害などが発生しても、もう1つは死なないようにすることなどもできる。(マルチAZ構成のこと)
たとえば大阪リージョンの場合は大阪市西区や中央区などにばらけて存在している。
ただし、AZ間をまたぐ通信にはだいたい料金が発生するため注意。</p>
<h2 id="sla">SLA</h2>
<h2 id="結果整合性">結果整合性</h2>
<h1 id="開発の勘どころ">開発の勘どころ</h1>
<h2 id="バッチ処理の実装">バッチ処理の実装</h2>
<p>以下のような処理はバッチで実装することが多いと思います。</p>
<ul>
<li>日時通知</li>
<li>案内メール送信</li>
</ul>
<h3 id="aws-lambda">AWS Lambda</h3>
<h3 id="開発言語">開発言語</h3>
<p>プログラミング言語は以下を使用します。</p>
<ul>
<li>TypeScript</li>
<li>Go</li>
<li>Rust</li>
<li>Java(GraalVM)</li>
</ul>
<h3 id="フレームワーク">フレームワーク</h3>
<p>プログラミング言語は以下を使用します。</p>
<ul>
<li>Serverless Framework</li>
</ul>
<h4 id="コールドスタートを避けようとしない">コールドスタートを避けようとしない</h4>
<p>provisionedConcurrencyでは、指定した以上の接続が発生するとコールドスタートは避けられません。</p>
<h1 id="非機能要件">非機能要件</h1>
<h2 id="sla">SLA</h2>
<h2 id="セキュリティ">セキュリティ</h2>
<h2 id="アクセシビリティ対応">アクセシビリティ対応</h2>
<h2 id> </h2>
<h2 id> </h2>
<h2 id> </h2>
<h1 id="iso-27001を取得しているサービス">ISO 27001を取得しているサービス</h1>
<p>実際のシステム開発では、AWSだけでなくLineやSlackなどの外部サービスを利用する必要があるケースもあります。</p>
<p>たとえば運用では、運用者（従業員だけでなく、外部委託なども想定）の管理や、システムからの運用者への通知を管理する必要があります。</p>
<p>運用で使用するためにLineやSlackを使用する場合、「ISO 27001を取得している」ことを以って提案すると通りやすいです。
以下はISO 27001を取得しているサービスの一覧です。</p>
<h2 id="aws">AWS</h2>
<h2 id="gcp">GCP</h2>
<h2 id="slack">Slack</h2>
<h2 id="line">Line</h2>
<h2 id="gitlab">GitLab</h2>
<h1 id="クラウドは実績があるのか？">クラウドは実績があるのか？</h1>
<p>クラウドを使用するために実績の例が必要であれば、以下が参考になるので確認してください。</p>
<h2 id="aws">AWS</h2>
<p>ソニー銀行</p>
<h2 id="gcp">GCP</h2>
<p>みんなの銀行：日本初の「デジタルバンク」として Google Cloud に勘定系を構築。Cloud Spanner で銀行基幹システムで求められる可用性を実現
<a href="https://cloud.google.com/blog/ja/topics/customers/minna-no-ginko-spanner" target="_blank">https://cloud.google.com/blog/ja/topics/customers/minna-no-ginko-spanner</a></p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../" class="navigation navigation-prev " aria-label="Previous page: よりよいシステム開発の手引き">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="how_to_develop.html" class="navigation navigation-next " aria-label="Next page: AIによるプログラム生成（またはフリーランス・オフショア・未熟なプログラマーなど）により開発されたプログラムの品質を担保する手法">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"利用者が増えても自動でスケールするシステムの開発手法","level":"1.2","depth":1,"next":{"title":"AIによるプログラム生成（またはフリーランス・オフショア・未熟なプログラマーなど）により開発されたプログラムの品質を担保する手法","level":"1.3","depth":1,"path":"markdown/how_to_develop.md","ref":"markdown/how_to_develop.md","articles":[]},"previous":{"title":"よりよいシステム開発の手引き","level":"1.1","depth":1,"path":"README.md","ref":"README.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-intopic-toc","-sharing","uml","mermaid-newface","hide-published-with"],"root":"./","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"uml":{"format":"svg","charset":"utf8","config":"classic","nailgun":false},"mermaid-newface":{},"hide-published-with":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":false,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":40,"left":40,"top":56,"bottom":56},"embedFonts":false},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"uml":{"charset":"UTF-8"},"variables":{},"language":"ja","gitbook":"*","publisher":""},"file":{"path":"markdown/how_to_management_aws_services.md","mtime":"2023-09-20T14:17:32.488Z","type":"markdown"},"gitbook":{"version":"5.1.0","time":"2023-09-20T14:18:50.067Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <noscript>
        <style>
            .honkit-cloak {
                display: block !important;
            }
        </style>
    </noscript>
    <script>
        // Restore sidebar state as critical path for prevent layout shift
        function __init__getSidebarState(defaultValue){
            var baseKey = "";
            var key = baseKey + ":sidebar";
            try {
                var value = localStorage[key];
                if (value === undefined) {
                    return defaultValue;
                }
                var parsed = JSON.parse(value);
                return parsed == null ? defaultValue : parsed;
            } catch (e) {
                return defaultValue;
            }
        }
        function __init__restoreLastSidebarState() {
            var isMobile = window.matchMedia("(max-width: 600px)").matches;
            if (isMobile) {
                // Init last state if not mobile
                return;
            }
            var sidebarState = __init__getSidebarState(true);
            var book = document.querySelector(".book");
            // Show sidebar if it enabled
            if (sidebarState && book) {
                book.classList.add("without-animation", "with-summary");
            }
        }

        try {
            __init__restoreLastSidebarState();
        } finally {
            var book = document.querySelector(".book");
            book.classList.remove("honkit-cloak");
        }
    </script>
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-hide-published-with/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

